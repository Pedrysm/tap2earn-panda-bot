<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crypto Panda - Advanced Tap2Earn</title>
    <meta name="description" content="Evoluciona tu panda, colecciona skins únicas y compite en torneos épicos">
    <meta name="theme-color" content="#000000">
    
    <!-- CSP corregido para Phaser + Supabase -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self' https://telegram.org;
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://telegram.org https://cdn.jsdelivr.net;
        style-src 'self' 'unsafe-inline';
        img-src 'self' data: https: blob:;
        connect-src 'self' https://telegram.org https://*.supabase.co;
        font-src 'self';
        object-src 'none';
        base-uri 'self';
        form-action 'none';
        frame-ancestors 'none';
    ">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div id="app">
        <!-- Splash Screen -->
        <div id="splash-screen" class="screen active">
            <div class="background-image"></div>
            <div class="background-overlay"></div>
            <div class="loading-content">
                <div class="progress-container" id="progressContainer">
                    <div class="progress-label">Cargando Crypto Panda Universe</div>
                    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
                </div>
                <button id="startBtn" class="start-button">INICIAR AVENTURA</button>
                <div class="game-features">
                    <div class="feature-item">Panda 10 Niveles de Evolución</div>
                    <div class="feature-item">Paint 20+ Skins Únicas</div>
                    <div class="feature-item">Trophy Torneos en Tiempo Real</div>
                    <div class="feature-item">Cards Sistema de Cartas</div>
                </div>
            </div>
        </div>

        <!-- Main Game Interface -->
        <div id="main-game" class="screen">
            <header class="game-header">
                <div class="player-main-info">
                    <div class="level-badge"><span id="playerLevel">1</span></div>
                    <div class="player-resources">
                        <div class="resource-item"><span class="resource-icon">Coin</span><span id="playerCoins">0</span><span class="resource-symbol">$PANDA</span></div>
                        <div class="resource-item"><span class="resource-icon">Gem</span><span id="playerGems">0</span></div>
                        <div class="resource-item"><span class="resource-icon">Lightning</span><span id="energyText">6000/6000</span></div>
                    </div>
                </div>
                <div class="energy-container">
                    <div class="energy-bar"><div class="energy-fill" id="energyFill"></div></div>
                </div>
                <div class="quick-actions">
                    <button class="action-btn" id="dailyRewardBtn" title="Recompensa Diaria"><span>Gift</span></button>
                    <button class="action-btn" id="tournamentBtn" title="Torneos"><span>Trophy</span></button>
                    <button class="action-btn" id="friendsBtn" title="Amigos"><span>Users</span></button>
                </div>
            </header>

            <nav class="game-navigation">
                <div class="nav-tabs">
                    <button class="nav-tab active" data-tab="tap"><span class="tab-icon">Pointing Up</span><span class="tab-text">TAP</span></button>
                    <button class="nav-tab" data-tab="evolution"><span class="tab-icon">Panda</span><span class="tab-text">EVOLUCION</span></button>
                    <button class="nav-tab" data-tab="skins"><span class="tab-icon">Paint</span><span class="tab-text">SKINS</span></button>
                    <button class="nav-tab" data-tab="cards"><span class="tab-icon">Cards</span><span class="tab-text">CARTAS</span></button>
                    <button class="nav-tab" data-tab="clan"><span class="tab-icon">City</span><span class="tab-text">CLAN</span></button>
                    <button class="nav-tab" data-tab="shop"><span class="tab-icon">Shopping Cart</span><span class="tab-text">TIENDA</span></button>
                </div>
            </nav>

            <main class="game-content">
                <div id="tab-content" class="tab-content">
                    <!-- PHASER SE INYECTA AQUÍ -->
                    <div id="panda-container" style="position:relative;width:100%;height:100%;overflow:hidden;background:transparent;">
                    </div>
                    <div class="combo-display" id="comboDisplay">
                        <span class="combo-text">COMBO</span>
                        <span class="combo-count">x1</span>
                    </div>
                </div>
            </main>

            <footer class="game-footer">
                <div class="boost-indicators">
                    <div class="boost-item" id="skinBoost"><span>Paint</span><span class="boost-value">1.0x</span></div>
                    <div class="boost-item" id="levelBoost"><span>Panda</span><span class="boost-value">1.0x</span></div>
                    <div class="boost-item" id="cardBoost"><span>Cards</span><span class="boost-value">0%</span></div>
                </div>
            </footer>
        </div>
    </div>

    <script>
    (function() {
        function waitForTelegram(cb) {
            if (window.Telegram && window.Telegram.WebApp) cb();
            else setTimeout(()=>waitForTelegram(cb),100);
        }
        waitForTelegram(()=>{
            const tg = window.Telegram.WebApp;
            tg.ready(); tg.expand();
            tg.setHeaderColor('#000000'); tg.setBackgroundColor('#000000');
            window.isTelegram = true;
        });
        setTimeout(()=>{ if(!window.isTelegram) window.isTelegram=false; },3000);
    })();
    </script>

    <!-- Tu lógica actual (coins, energy, tabs, etc.) -->
    <script src="js/main.js"></script>

    <!-- Panda mítico con Phaser + skins desde Supabase -->
    <script type="module" src="js/phaser-game.js"></script>
</body>
</html>
