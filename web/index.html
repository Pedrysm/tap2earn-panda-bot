<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Crypto Panda 2025</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { margin:0; overflow:hidden; background:#000; color:white; }
    #panda { transition:transform .15s; }
    .tap { position:absolute; pointer-events:none; font-weight:bold; color:#ffd700; text-shadow:0 0 20px gold; animation:float 1s forwards; }
    @keyframes float { to { transform:translateY(-150px) scale(2); opacity:0; } }
    .loading-bar { height:8px; background:#333; border-radius:4px; overflow:hidden; margin-top:20px; }
    .loading-fill { height:100%; background:linear-gradient(90deg,#ffd700,#ffaa00); width:0%; animation:load 5s linear forwards; }
    @keyframes load { to { width:100%; } }
    .start-btn { animation:pulse 2s infinite; }
    @keyframes pulse { 0%,100% { transform:scale(1); } 50% { transform:scale(1.1); } }
  </style>
</head>
<body class="h-screen flex flex-col">

  <!-- PANTALLA DE CARGA ÉPICA -->
  <div id="splash" class="flex-1 flex flex-col items-center justify-end bg-cover bg-center pb-20" style="background-image:url('https://i.ibb.co/w8pgDM6/crypto-panda-epic.jpg')">
    
    <div class="w-80 text-center">
      <p class="text-5xl font-bold text-yellow-400 mb-2">loading</p>
      <div class="loading-bar"><div class="loading-fill"></div></div>
    </div>

    <button id="startBtn" class="hidden mt-12 px-16 py-6 bg-gradient-to-r from-yellow-600 to-yellow-400 text-black text-5xl font-bold rounded-2xl shadow-2xl start-btn">
      Start game
    </button>
  </div>

  <!-- JUEGO -->
  <div id="game" class="flex-1 flex flex-col hidden bg-gradient-to-b from-blue-950 to-black">
    <div class="p-4 text-center">
      <div class="text-5xl font-bold" id="coins">0 $PANDA</div>
      <div class="text-3xl mt-2" id="energy">6000 / 6000 ⚡️</div>
    </div>

    <div class="flex-1 flex items-center justify-center relative" id="tapArea">
      <img id="panda" src="https://i.ibb.co/hoodie-panda-base.png" class="w-80 h-80" alt="Panda" />
    </div>

    <div class="fixed bottom-0 w-full bg-black bg-opacity-90 p-4 flex justify-around text-5xl">
      <button onclick="alert('Próximamente')">Panda</button>
      <button onclick="alert('Próximamente')">Rocket</button>
      <button onclick="alert('Daily Combo 10M pronto')">Gift</button>
      <button onclick="alert('Referidos pronto')">Friends</button>
      <button onclick="alert('Liga semanal pronto')">Trophy</button>
    </div>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const supabase = createClient(
      import.meta.env.VITE_SUPABASE_URL || "https://mixbbsgniudsgcucyfwe.supabase.co",
      import.meta.env.VITE_SUPABASE_ANON_KEY || "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1peGJic2duaXVkc2djdWN5ZndlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3MzI5MjYsImV4cCI6MjA3OTMwODkyNn0.7nFucL4SgTmktM1UPFl_xffu1CYvpG_RO-O6tGcM5jk"
    )

    const tg = window.Telegram.WebApp
    tg.ready()
    const userId = BigInt(tg.initDataUnsafe?.user?.id || 123456789)

    let profile = { coins: 0, energy: 6000, max_energy: 6000, multitap: 1 }

    setTimeout(() => {
      document.getElementById('startBtn').classList.remove('hidden')
    }, 5000)

    document.getElementById('startBtn').onclick = async () => {
      document.getElementById('splash').classList.add('hidden')
      document.getElementById('game').classList.remove('hidden')
      await initGame()
    }

    async function initGame() {
      const { data } = await supabase.from('profiles').select('*').eq('telegram_id', userId).maybeSingle()
      if (data) profile = data
      else await supabase.from('profiles').insert({ telegram_id: userId })

      updateUI()
      setInterval(recharge, 1000)
    }

    function updateUI() {
      document.getElementById('coins').textContent = Number(profile.coins || 0).toLocaleString() + ' $PANDA'
      document.getElementById('energy').textContent = `${profile.energy || 6000} / ${profile.max_energy || 6000} ⚡️`
    }

    document.getElementById('tapArea').onclick = async (e) => {
      if ((profile.energy || 0) <= 0) return
      profile.energy -= 1
      profile.coins = Number(profile.coins || 0) + (profile.multitap || 1)

      await supabase.from('profiles').update({ coins: profile.coins, energy: profile.energy }).eq('telegram_id', userId)
      updateUI()

      const fx = document.createElement('div')
      fx.className = 'tap text-7xl'
      fx.textContent = '+' + (profile.multitap || 1)
      fx.style.left = e.clientX - 50 + 'px'
      fx.style.top = e.clientY - 100 + 'px'
      document.body.appendChild(fx)
      setTimeout(() => fx.remove(), 1000)

      const p = document.getElementById('panda')
      p.style.transform = 'scale(0.9)'
      setTimeout(() => p.style.transform = '', 150)
    }

    function recharge() {
      if ((profile.energy || 0) < (profile.max_energy || 6000)) {
        profile.energy += 1
        supabase.from('profiles').update({ energy: profile.energy }).eq('telegram_id', userId)
        updateUI()
      }
    }
  </script>
</body>
</html>
